@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <title>泉州华中科技大学智能制造研究院</title>
    <link rel="stylesheet" href="~/Content/element.css" />
    <link rel="stylesheet" href="~/Content/display.css" />
    <link rel="stylesheet" href="~/Content/site.css" />
    <script src="~/Scripts/jquery-3.2.1.min.js"></script>
    <script src="~/Scripts/lib.js"></script>
    <script src="~/Scripts/config.js"></script>
    <script src="~/Scripts/ezuikit.js"></script>
    <script src="~/Scripts/echarts-all.js"></script>
    <script>
        var lineChart, barChart, lineOption, barOption
        
    </script>
</head>
<body id="body" style="background-color:white;">
    <div id="app">
        <el-header>
        </el-header>
        <el-container>
            <el-main>
                <div>
                    <div class="el-container" style="border: 1px solid #eee">

                        <!--右侧实体内容-->

                        <el-main id="partPage">
                            <div>
                                <div id="lineChart" style="height:300px;width:800px;"></div>
                                <hr />
                                <div id="barChart" style="height:300px;width:800px;"></div>
                                <hr />
                                <img id="hideLineImg" src="" />
                                <hr />
                                <img id="hideBarImg" src="" />
                            </div>
                        </el-main>

                        <script>
                            var lineChart, barChart, lineOption, barOption
                            var barTableConfig = {
                                BiaoQianConsumption: "标签用量",
                                DaDiConsumption: "大底用量",
                                HuChiConsumption: "护齿用量",
                                WeiTiaoConsumption: "围条用量"
                            }
                            var date = new Date()
                            var dateStr = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate()
                            var lineId = 1
                            //折线图
                            lineChart = echarts.init(document.getElementById('lineChart'));
                            lineOption = {
                                title: {
                                    text: '产量增长图',
                                    x: 'center'
                                },
                                legend: {
                                    data: ['当班产量', '预加工量'],
                                    x: 'left'
                                },
                                tooltip: {
                                    trigger: 'axis'
                                },
                                toolbox: {
                                    show: true,
                                    feature: {
                                        mark: { show: true },
                                        dataView: { show: true, readOnly: false },
                                        magicType: {
                                            show: true,
                                            type: ['line', 'bar']
                                        },
                                        restore: { show: true },
                                        saveAsImage: { show: true }
                                    }
                                },
                                calculable: true,
                                xAxis: [
                                    {
                                        type: 'category',
                                        boundaryGap: false,
                                        data: ['0']
                                    }
                                ],
                                yAxis: [
                                    {
                                        type: 'value',
                                        axisLabel: {
                                            formatter: '{value} 只'
                                        }
                                    }
                                ],
                                series: [
                                    {
                                        name: '当班产量',
                                        type: 'line',
                                        data: [0],
                                        markPoint: {
                                            data: [
                                                { type: 'max', name: '当班产量' }
                                            ]
                                        },
                                    },
                                    {
                                        name: '预加工量',
                                        type: 'line',
                                        data: [0],
                                        markPoint: {
                                            data: [
                                                { type: 'max', name: '预加工量' }
                                            ]
                                        },
                                    }
                                ]
                            };
                            lineChart.setOption(lineOption);
                            
                            //柱状图
                            barChart = echarts.init(document.getElementById('barChart'));
                            barOption = {
                                title: {
                                    text: '用料统计图',
                                    x: 'center'
                                },
                                toolbox: {
                                    show: true,
                                    feature: {
                                        mark: { show: true },
                                        dataView: { show: true, readOnly: false },
                                        restore: { show: true },
                                        saveAsImage: { show: true }
                                    }
                                },
                                calculable: true,
                                grid: {
                                    borderWidth: 0,
                                    y: 80,
                                    y2: 60
                                },
                                xAxis: [
                                    {
                                        type: 'category',
                                        show: false,
                                        data: ['围条用量', '护齿用量', '标签用量', '大底用量']
                                    }
                                ],
                                yAxis: [
                                    {
                                        type: 'value',
                                        show: false
                                    }
                                ],
                                series: [
                                    {
                                        name: '用料统计',
                                        type: 'bar',
                                        itemStyle: {
                                            normal: {
                                                color: function (params) {
                                                    // build a color map as your need.
                                                    var colorList = [
                                                        '#C1232B', '#B5C334', '#FCCE10', '#E87C25', '#27727B',
                                                        '#FE8463', '#9BCA63', '#FAD860', '#F3A43B', '#60C0DD',
                                                        '#D7504B', '#C6E579', '#F4E001', '#F0805A', '#26C0C0'
                                                    ];
                                                    return colorList[params.dataIndex]
                                                },
                                                label: {
                                                    show: true,
                                                    position: 'top',
                                                    formatter: '{b}\n{c}'
                                                }
                                            }
                                        },
                                        data: [0, 0, 0, 0]
                                    }
                                ]
                            };
                            barChart.setOption(barOption);

                            //获取数据
                            intervalId = window.setInterval(function () {
                                getLineData({ DataTime: dateStr, Count: 100 })
                                getBarData({ DataTime: dateStr, lineid: lineId })
                            }, 50000)
                            getLineData({ DataTime: dateStr, Count: 100 })
                            getBarData({ DataTime: dateStr, lineid: lineId })

                            //获取产量图数据方法
                            function getLineData(param) {
                                $.ajax({
                                    url: "/Statistics/GetCurrentProduction" + _formatQueryStr(param),
                                    success: function (data) {
                                        var xArr = [], y1Arr = [], y2Arr = []
                                        console.log("获取产量图数据")
                                        //console.log(data)
                                        data = JSON.parse(data).Rows
                                        for (let d = 0; d < data.length; d++) {
                                            xArr.push(data[d].ID_RealTimeUsage)
                                            y1Arr.push(parseInt(data[d].NowN))
                                            y2Arr.push(parseInt(data[d].ChildN))
                                        }
                                        lineOption.xAxis[0].data = xArr
                                        lineOption.series[0].data = y1Arr
                                        lineOption.series[1].data = y2Arr
                                        lineChart.setOption(lineOption)
                                        window.setTimeout(function () {
                                            var b = lineChart.getDataURL()
                                            $("#hideLineImg").attr("src", b)
                                        }, 500)
                                    }
                                })
                            }
                            //获取用量图数据
                            function getBarData(param) {
                                var url = "/Statistics/GetDosageInfo" + _formatQueryStr(param)
                                $.ajax({
                                    url: url,
                                    success: function (data) {
                                        console.log("获取用量图数据")
                                        console.log(url)
                                        console.log(data)
                                        data = JSON.parse(data)[0]
                                        var xArr = [], yArr = []
                                        for (var d in data) {
                                            xArr.push(barTableConfig[d])
                                            yArr.push(data[d])
                                        }
                                        barOption.xAxis[0].data = xArr
                                        barOption.series[0].data = yArr
                                        barChart.setOption(barOption)
                                        window.setTimeout(function () {
                                            var b = barChart.getDataURL()
                                            $("#hideBarImg").attr("src", b)
                                        }, 500)
                                    }
                                })
                            }
                        </script>

                    </div>
                </div>
            </el-main>
        </el-container>
        <div class="el-footer">
        </div>
    </div>
    <div id="tempPage"></div>
</body>
</html>


